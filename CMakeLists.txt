cmake_minimum_required (VERSION 3.16)

project (viewer)

find_package(OpenGL REQUIRED)

#Tells compiler to use c++ 20
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/bin)

# Enable the required dependencies
set(DEP_GLFW ON CACHE BOOL "Build GLFW")
set(DEP_GLM ON CACHE BOOL "Build GLM")
set(DEP_GLEW ON CACHE BOOL "Build GLEW")
set(DEP_FREETYPE ON CACHE BOOL "Build FreeType")
set(DEP_STB ON CACHE BOOL "Include STB headers")
set(DEP_IMGUI ON CACHE BOOL "Build Dear ImGui")

# ImGui options
set(DEP_IMGUI_BACKEND_GLFW ON CACHE BOOL "ImGui GLFW backend")
set(DEP_IMGUI_BACKEND_OPENGL3 ON CACHE BOOL "ImGui OpenGL3 backend")
set(DEP_IMGUI_FREETYPE ON CACHE BOOL "ImGui FreeType support")

# Add dependencies
add_subdirectory(dependencies)

#GLFW settings
set(BUILD_SHARED_LIBS OFF CACHE BOOL "")
set(GLFW_BUILD_EXAMPLES OFF CACHE BOOL "")
set(GLFW_BUILD_TESTS OFF CACHE BOOL "")
set(GLFW_BUILD_DOCS OFF CACHE BOOL "")
set(GLFW_INSTALL OFF CACHE BOOL "")

# Set up executable
set(SOURCE_DIR "${PROJECT_SOURCE_DIR}/src")
add_subdirectory(${SOURCE_DIR})

target_include_directories(
        ${PROJECT_NAME} PRIVATE
        ${GLFW_SOURCE_DIR}/include
        ${GLEW_SOURCE_DIR}/include
        ${IMGUI_SOURCE_DIR}
        ${STB_SOURCE_DIR}
)

# OpenGL (system)
find_package(OpenGL REQUIRED)
target_link_libraries(${PROJECT_NAME} PRIVATE OpenGL::GL)

# Project dependencies
target_link_libraries(${PROJECT_NAME} PRIVATE
        # glfw  ## GLFW is linked implicitly via imgui
        glm
        glew_static
        stb
        imgui
)

if (WIN32)
    add_compile_definitions(GLEW_STATIC)
    target_link_libraries(${PROJECT_NAME} opengl32 glu32)
endif()

if (UNIX AND NOT APPLE)
    target_link_libraries(${PROJECT_NAME} GL)
endif()